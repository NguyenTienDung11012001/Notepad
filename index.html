<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Web Notepad</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="app">
    <header>
      <span class="brand">📘 Notepad</span>
      <div class="toolbar">
        <input id="filename" type="text" placeholder="Tên ghi chú..." />
        <button id="saveBtn">💾 Lưu</button>
        <button id="clearBtn" class="secondary">🧹 Xóa</button>
        <button id="themeToggle">🌙</button>
      </div>
    </header>

    <div class="main">
      <textarea id="editor" placeholder="Nhập ghi chú của bạn ở đây..."></textarea>
      <div class="side">
        <div class="card">
          <b>Ghi chú gần đây</b>
          <ul id="noteList"></ul>
        </div>
      </div>
    </div>

    <div class="footer">
      <span class="status" id="status">Đã sẵn sàng.</span>
      <small>Made with ❤️ on GitHub Pages</small>
    </div>
  </div>

  <script>
    const editor = document.getElementById('editor');
    const filenameInput = document.getElementById('filename');
    const saveBtn = document.getElementById('saveBtn');
    const clearBtn = document.getElementById('clearBtn');
    const noteList = document.getElementById('noteList');
    const status = document.getElementById('status');
    const themeToggle = document.getElementById('themeToggle');

    // --- Theme ---
    const currentTheme = localStorage.getItem('theme') || 'dark';
    document.body.setAttribute('data-theme', currentTheme);
    themeToggle.textContent = currentTheme === 'dark' ? '🌙' : '☀️';
    themeToggle.onclick = () => {
      const newTheme = document.body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
      document.body.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
      themeToggle.textContent = newTheme === 'dark' ? '🌙' : '☀️';
    };

    // --- Save note ---
    function saveNote(isAuto = false) {
      const name = filenameInput.value.trim() || 'Ghi chú không tên';
      const content = editor.value;
      localStorage.setItem(name, content);
      updateList();
      status.textContent = isAuto ? `Đã tự động lưu "${name}"` : `Đã lưu "${name}"`;
    }

    saveBtn.onclick = () => saveNote(false);

    // --- Clear text ---
    clearBtn.onclick = () => {
      editor.value = '';
      status.textContent = 'Đã xóa nội dung.';
    };

    // --- Load note ---
    noteList.onclick = (e) => {
      if (e.target.tagName === 'SPAN') {
        const name = e.target.textContent;
        editor.value = localStorage.getItem(name);
        filenameInput.value = name;
        status.textContent = `Đang mở "${name}"`;
      }
    };

    // --- Delete note ---
    function deleteNote(name) {
      if (confirm(`Bạn có chắc muốn xóa "${name}"?`)) {
        localStorage.removeItem(name);
        updateList();
        status.textContent = `Đã xóa "${name}".`;
      }
    }

    // --- Update list ---
    function updateList() {
      noteList.innerHTML = '';
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key !== 'theme') {
          const li = document.createElement('li');
          li.innerHTML = `
            <span style="cursor:pointer;">${key}</span>
            <button class="delete-btn" onclick="deleteNote('${key}')">❌</button>
          `;
          li.style.display = 'flex';
          li.style.justifyContent = 'space-between';
          li.style.alignItems = 'center';
          li.style.padding = '4px 0';
          noteList.appendChild(li);
        }
      }
    }

    // --- Auto save (2s delay after typing) ---
    let autoSaveTimer;
    editor.addEventListener('input', () => {
      clearTimeout(autoSaveTimer);
      autoSaveTimer = setTimeout(() => {
        if (editor.value.trim() !== '') saveNote(true);
      }, 2000);
    });

    // --- Init ---
    updateList();
    window.deleteNote = deleteNote;
  </script>
</body>
</html>
